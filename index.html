<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Portal</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Sidebar (desktop) / Topbar (mobile) -->
    <div id="sidebar" class="sidebar hidden">
        <div class="sidebar-header">
            <img id="sidebarProfilePic" class="profile-img" src="" alt="Profile">
        </div>
        <button class="sidebar-toggle">â˜°</button>
        <div id="sidebarNav">
            <button id="homeBtn">Home</button>
            <button id="myRolesBtn">My Roles</button>
            <button id="tasksBtn">Tasks</button>
            <button id="absencesBtn">Absences</button>
            <button id="payslipsBtn">Payslips</button>
            <button id="disciplinariesBtn">Disciplinaries</button>
            <button id="timeclockBtn">Timeclock</button>
            <button id="mailBtn">Mail</button>
            <button id="handbooksBtn">Handbooks</button>
        </div>
        <div class="sidebar-footer">
            <img src="https://media.discordapp.net/attachments/1315278404009988107/1315278404412768266/Utilities.png?ex=68e8ed78&is=68e79bf8&hm=27f1b2498c2043117d89a2d04ed0e42d509e442639da1a553ed7dbed9fa4733c&=&format=webp&quality=lossless&width=550&height=550" alt="logo" style="width: 30px; height: auto;">
            <button id="logoutBtn" class="action-btn" title="Log Out">Log Out</button>
        </div>
    </div>

    <!-- Notifications Panel -->
    <div id="notificationPanel" class="notifications hidden">
        <h3>Notifications</h3>
        <ul id="notificationList"></ul>
    </div>

    <!-- Modals -->
    <div id="alertModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="alertMessage"></div>
        </div>
    </div>
    <div id="composeMailModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="mail-compose">
                <h2>Compose Mail</h2>
                <select id="mailRecipients" multiple required>
                    <option value="" disabled>Select Recipients</option>
                </select>
                <input type="text" id="mailSubject" placeholder="Subject">
                <textarea id="mailContent" placeholder="Message"></textarea>
                <input type="file" id="mailAttachments" multiple>
                <div id="mailError" class="mail-error hidden">Select at least one participant</div>
                <div class="mail-actions">
                    <button id="sendMailBtn">Send</button>
                    <button id="saveDraftBtn">Save to Drafts</button>
                </div>
            </div>
        </div>
    </div>
    <div id="resetProfileModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Reset Profile</h2>
            <p>Are you sure you want to reset your profile? This cannot be undone.</p>
            <button id="confirmResetBtn">Confirm</button>
        </div>
    </div>
    <div id="absenceRequestModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Request Absence</h2>
            <select id="absenceType">
                <option value="Illness">Illness</option>
                <option value="Vacation">Vacation</option>
                <option value="Personal">Personal</option>
                <option value="Education">Education</option>
                <option value="No Device/Wifi">No Device/Wifi</option>
                <option value="Other">Other (specify in comment)</option>
            </select>
            <input type="date" id="absenceStartDate">
            <input type="date" id="absenceEndDate">
            <textarea id="absenceComment" placeholder="Comment"></textarea>
            <p id="absenceDays">Total Days: 0</p>
            <button id="submitAbsenceBtn">Submit</button>
        </div>
    </div>
    <div id="deptChangeModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Change Department</h2>
            <p>Which department do you wish to change to?</p>
            <label><input type="radio" name="newDepartment" value="Development Department"> Development</label>
            <label><input type="radio" name="newDepartment" value="Customer Relations Department"> Customer Relations</label>
            <label><input type="radio" name="newDepartment" value="Finance Department"> Finance</label>
            <button id="submitDeptChangeBtn">Submit</button>
        </div>
    </div>
    <div id="viewMailModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="viewMailContent"></div>
            <button id="replyMailBtn" class="hidden">Reply</button>
        </div>
    </div>
    <div id="replyMailModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Reply to Mail</h2>
            <textarea id="replyContent" placeholder="Your reply..."></textarea>
            <button id="sendReplyBtn">Send</button>
        </div>
    </div>
    <div id="absenceDetailModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Absence Details</h2>
            <div id="absenceDetailContent" class="absence-details">
                <p><strong>Type:</strong> <span id="absenceDetailType"></span></p>
                <p><strong>Start Date:</strong> <span id="absenceDetailStartDate"></span></p>
                <p><strong>End Date:</strong> <span id="absenceDetailEndDate"></span></p>
                <p><strong>Total Days:</strong> <span id="absenceDetailDays"></span></p>
                <p><strong>Reason:</strong> <span id="absenceDetailReason"></span></p>
                <p><strong>Comment:</strong> <span id="absenceDetailComment"></span></p>
            </div>
            <button id="cancelAbsenceBtn" class="cancel-absence-btn hidden">Cancel Absence</button>
            <button id="deleteAbsenceBtn" class="delete-absence-btn hidden">Delete Absence</button>
        </div>
    </div>
    <div id="confirmCancelAbsenceModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Confirm Absence Cancellation</h2>
            <p>Are you sure you want to cancel your absence?</p>
            <button id="confirmCancelAbsenceBtn" class="cancel-absence-btn">Cancel Absence</button>
            <button id="noCancelAbsenceBtn">No</button>
        </div>
    </div>
    <div id="payslipViewModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Payslip Details</h2>
            <div id="payslipViewContent">
                <p><strong>Date:</strong> <span id="payslipDate"></span></p>
                <p><strong>Link:</strong> <a id="payslipLink" href="#" target="_blank">View Payslip</a></p>
                <p><strong>Comment:</strong> <span id="payslipComment"></span></p>
                <p><strong>Assigned by:</strong> <span id="payslipAssignedBy"></span></p>
            </div>
        </div>
    </div>

    <!-- Screens -->
    <div id="discordScreen" class="screen">
        <div class="container">
            <img class="logo" src="https://media.discordapp.net/attachments/1315278404009988107/1322985671773655200/Cirkledevblack.png?ex=68e89f2c&is=68e74dac&hm=b8bc37a71a49e8136a1a05fd89154cd1a2ac00ffe3af6112d42e49610cc76582&=&format=webp&quality=lossless&width=1056&height=594" alt="Logo">
            <h1>Welcome, please log in using Discord</h1>
            <button id="discordLoginBtn">Login with Discord</button>
        </div>
    </div>
    <div id="searchingScreen" class="screen loading-screen">
        <div class="container black-bg">
            <h2>Searching...</h2>
            <div class="spinner"></div>
        </div>
    </div>
    <div id="rolesScreen" class="screen loading-screen">
        <div class="container black-bg">
            <h2>Checking Roles...</h2>
            <div class="spinner"></div>
        </div>
    </div>
    <div id="cherryScreen" class="screen loading-screen">
        <div class="container black-bg">
            <h2>Verifying...</h2>
            <div class="spinner"></div>
        </div>
    </div>
    <div id="confirmScreen" class="screen">
        <div class="container">
            <h2>Profile Found</h2>
            <p>Please select "Finalise" to continue.</p>
            <button id="continueBtn">Finalise</button>
        </div>
    </div>
    <div id="setupWelcomeScreen" class="screen">
        <div class="container">
            <h2>Welcome!</h2>
            <p>Please set up your profile to continue.</p>
            <button id="setupStartBtn">Start</button>
        </div>
    </div>
    <div id="setupEmailScreen" class="screen">
        <div class="container">
            <h2>Please add your email</h2>
            <input type="email" id="setupEmailInput" placeholder="Email">
            <button id="setupEmailContinueBtn">Continue</button>
        </div>
    </div>
    <div id="setupNameScreen" class="screen">
        <div class="container">
            <h2>Let's give you a proper identity</h2>
            <p>Please insert your first and last name (not your real one, the one you use in the server)</p>
            <input type="text" id="setupNameInput" placeholder="First Last">
            <button id="setupNameContinueBtn">Continue</button>
        </div>
    </div>
    <div id="setupPreferencesScreen" class="screen">
        <div class="container">
            <h2>Let's set up your preferences</h2>
            <div class="preference-group">
                <h3>Timezone</h3>
                <select id="setupTimezoneSelect">
                    <option value="UTC">UTC (Coordinated Universal Time)</option>
                    <option value="America/New_York">Eastern Time (ET)</option>
                    <option value="America/Chicago">Central Time (CT)</option>
                    <option value="America/Denver">Mountain Time (MT)</option>
                    <option value="America/Los_Angeles">Pacific Time (PT)</option>
                    <option value="Europe/London">British Time (GMT/BST)</option>
                    <option value="Europe/Paris">Central European Time (CET)</option>
                    <option value="Europe/Berlin">Central European Time (CET)</option>
                    <option value="Asia/Tokyo">Japan Standard Time (JST)</option>
                    <option value="Asia/Shanghai">China Standard Time (CST)</option>
                    <option value="Australia/Sydney">Australian Eastern Time (AET)</option>
                </select>
            </div>
            <div class="preference-group">
                <h3>Date Format</h3>
                <label><input type="radio" name="dateFormat" value="MM/DD/YYYY"> MM/DD/YYYY (US)</label>
                <label><input type="radio" name="dateFormat" value="DD/MM/YYYY"> DD/MM/YYYY (UK/EU)</label>
                <label><input type="radio" name="dateFormat" value="YYYY-MM-DD"> YYYY-MM-DD (ISO)</label>
            </div>
            <div class="preference-group">
                <h3>Country</h3>
                <select id="setupCountrySelect">
                    <option value="US">United States</option>
                    <option value="UK">United Kingdom</option>
                    <option value="CA">Canada</option>
                    <option value="AU">Australia</option>
                    <option value="DE">Germany</option>
                    <option value="FR">France</option>
                    <option value="IT">Italy</option>
                    <option value="ES">Spain</option>
                    <option value="NL">Netherlands</option>
                    <option value="JP">Japan</option>
                    <option value="CN">China</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <button id="setupPreferencesContinueBtn">Continue</button>
        </div>
    </div>
    <div id="setupDepartmentScreen" class="screen">
        <div class="container">
            <h2>Finally, let's select your department</h2>
            <label><input type="radio" name="department" value="Development Department"> Development</label>
            <label><input type="radio" name="department" value="Customer Relations Department"> Customer Relations</label>
            <label><input type="radio" name="department" value="Finance Department"> Finance</label>
            <button id="setupDepartmentContinueBtn">Continue</button>
        </div>
    </div>
    <div id="setupVerifyScreen" class="screen loading-screen">
        <div class="container black-bg">
            <h2>Verifying...</h2>
            <div class="spinner"></div>
            <p class="loading-text">Just setting up your profile</p>
            <p class="loading-text">Creating your unique interface</p>
            <p class="loading-text">Finalising</p>
        </div>
    </div>
    <div id="setupCompleteScreen" class="screen">
        <div class="container">
            <h2>Welcome, <span id="setupWelcomeName"></span>, to your new Staff Portal!</h2>
            <p>Let's take a look around!</p>
            <button id="setupCompleteBtn">Continue</button>
        </div>
    </div>
    <div id="portalWelcomeScreen" class="screen">
        <div class="container">
            <img id="portalWelcomeProfilePic" class="profile-img" src="" alt="Profile" style="display:block;margin:0 auto 1em auto;width:100px;height:100px;border-radius:50%;object-fit:cover;">
            <h2>Welcome back, <span id="portalWelcomeName"></span>!</h2>
            <p>Previous login: <span id="portalLastLogin"></span></p>
            <button id="portalLoginBtn">Log In</button>
        </div>
    </div>
    <div id="mainMenuScreen" class="screen">
        <div class="container">
            <div class="user-header">
                <img id="mainProfilePic" class="profile-img" src="" alt="Profile">
                <div>
                    <h2 id="greeting"></h2>
                    <p id="lastLogin"></p>
                </div>
                <p id="dateTime" style="margin-left: auto;"></p>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Absences</h3>
                    <p id="totalAbsences">0</p>
                    <h3>Total Absence Days</h3>
                    <p id="totalAbsenceDays">0</p>
                </div>
                <div class="stat-card">
                    <h3>Department</h3>
                    <p id="currentDepartment">Development</p>
                    <p class="hint">Wish to change? Click the button below to go to your profile settings and request a change.</p>
                    <button id="changeDepartmentBtn">Change My Department</button>
                </div>
            </div>
        </div>
    </div>
        <div id="myProfileScreen" class="screen">
        <div class="container">
            <div class="profile-container">
                <!-- Profile Header -->
                <div class="profile-header">
                    <div class="profile-avatar">
                        <img id="profilePic" class="profile-img-large" src="" alt="Profile Picture">
                        <div class="profile-status-indicator" id="profileStatusIndicator"></div>
                    </div>
                    <div class="profile-header-info">
                        <h2 id="profileDisplayName">User Profile</h2>
                        <p class="profile-subtitle" id="profileSubtitle">Staff Member</p>
                        <div class="profile-badges">
                            <span class="profile-badge" id="statusBadge">Active</span>
                            <span class="profile-badge" id="deptBadge"></span>
                        </div>
                    </div>
                </div>

                <!-- Profile Information Card -->
                <div class="profile-card">
                    <h3 class="profile-card-title">Personal Information</h3>
                    <div class="profile-info-grid">
                        <div class="profile-row">
                            <span class="profile-label">Name:</span>
                            <span id="profileName"></span>
                            <button class="edit-btn" id="editNameBtn" title="Request Name Change">âœŽ</button>
                        </div>
                        <div class="profile-row">
                            <span class="profile-label">Email:</span>
                            <span id="profileEmail"></span>
                            <button class="edit-btn" id="editEmailBtn" title="Edit Email">âœŽ</button>
                        </div>
                        <div class="profile-row">
                            <span class="profile-label">Department:</span>
                            <span id="profileDepartment"></span>
                            <button class="edit-btn" id="editDeptBtn" title="Request Department Change">âœŽ</button>
                        </div>
                    </div>
                    <div id="editFieldsContainer" class="edit-fields-container"></div>
                </div>

                <!-- Profile Statistics Card -->
                <div class="profile-card">
                    <h3 class="profile-card-title">Overview</h3>
                    <div class="profile-stats-grid">
                        <div class="profile-stat">
                            <span class="stat-value" id="totalAbsences">0</span>
                            <span class="stat-label">Total Absences</span>
                        </div>
                        <div class="profile-stat">
                            <span class="stat-value" id="pendingAbsences">0</span>
                            <span class="stat-label">Pending Absences</span>
                        </div>
                        <div class="profile-stat">
                            <span class="stat-value" id="totalPayslips">0</span>
                            <span class="stat-label">Payslips</span>
                        </div>
                        <div class="profile-stat">
                            <span class="stat-value" id="totalDisciplinaries">0</span>
                            <span class="stat-label">Disciplinaries</span>
                        </div>
                    </div>
                </div>
                
                <!-- Change Requests Card -->
                <div class="profile-card">
                    <div class="profile-card-header">
                        <h3 class="profile-card-title">Change Requests</h3>
                        <button id="refreshRequestsBtn" class="action-btn secondary">Refresh</button>
                    </div>
                    <div id="changeRequestsList" class="change-requests-list">
                        <!-- Dynamic content will be inserted here -->
                    </div>
                </div>

                <!-- Profile Actions Card -->
                <div class="profile-card">
                    <h3 class="profile-card-title">Account Actions</h3>
                    <div class="profile-actions">
                        <button id="resetProfileBtn" class="action-btn danger">Reset Profile</button>
                    </div>
                </div>
                
                <div id="profileDebug" style="margin-top:16px;color:#b71c1c;font-size:0.95em;"></div>
                <div id="authDebug" style="margin-top:8px;color:#1976d2;font-size:0.95em;"></div>
            </div>
        </div>
    </div>
    <div id="myRolesScreen" class="screen">
        <div class="container">
            <h2>My Roles</h2>
            <ul id="rolesList"></ul>
        </div>
    </div>
    <div id="tasksScreen" class="screen">
        <div class="container">
            <h2>Tasks</h2>
            <div class="task-input">
                <input type="text" id="taskInput" placeholder="Add a task">
                <button id="addTaskBtn">&#8594;</button>
            </div>
            <ul id="tasksList"></ul>
        </div>
    </div>
    <div id="absencesScreen" class="screen">
        <div class="container">
            <h2>Absences</h2>
            <button id="requestAbsenceBtn">Request Absence</button>
            <div class="absence-tabs">
                <button class="absence-tab-btn active" data-tab="pending">Pending</button>
                <button class="absence-tab-btn" data-tab="approved">Approved</button>
                <button class="absence-tab-btn" data-tab="rejected">Rejected</button>
                <button class="absence-tab-btn" data-tab="archived">Archived</button>
                <div class="absence-tab-slider"></div>
            </div>
            <div class="absence-content">
                <div id="pendingFolder" class="absence-folder active">
                    <ul id="pendingAbsences"></ul>
                </div>
                <div id="approvedFolder" class="absence-folder">
                    <ul id="approvedAbsences"></ul>
                </div>
                <div id="rejectedFolder" class="absence-folder">
                    <ul id="rejectedAbsences"></ul>
                </div>
                <div id="archivedFolder" class="absence-folder">
                    <ul id="archivedAbsences"></ul>
                </div>
            </div>
        </div>
    </div>
    <div id="payslipsScreen" class="screen">
        <div class="container">
            <h2>Payslips</h2>
            <div id="payslipsContent"></div>
        </div>
    </div>
    <div id="disciplinariesScreen" class="screen">
        <div class="container">
            <h2>Disciplinaries</h2>
            <div id="disciplinariesContent">
                <div id="disciplinariesList" class="disciplinaries-list">
                    <!-- Dynamic content will be inserted here -->
                </div>
                <div id="disciplinariesEmpty" class="empty-state hidden">
                    <p>No disciplinaries found.</p>
                </div>
                <div id="disciplinariesLoading" class="loading-state">
                    <p>Loading disciplinaries...</p>
                </div>
            </div>
        </div>
    </div>
    <div id="timeclockScreen" class="screen">
        <div class="container">
            <h2>Timeclock</h2>
            <div id="clockDisplay"></div>
            <button id="clockInBtn">Clock In</button>
            <button id="clockOutBtn" class="hidden">Clock Out</button>
            <div id="sessionInfo" class="session-item hidden"></div>
            <h3>Previous Sessions</h3>
            <div id="previousSessions" class="session-list"></div>
        </div>
    </div>
    <div id="mailScreen" class="screen">
        <div class="container">
            <h2>Mail</h2>
            <button id="composeMailBtn" title="Compose Mail"></button>
            <div class="mail-tabs">
                <button class="tab-btn active" data-tab="inbox">Inbox</button>
                <button class="tab-btn" data-tab="sent">Sent</button>
                <button class="tab-btn" data-tab="drafts">Drafts</button>
                <div class="tab-slider"></div>
            </div>
            <div class="mail-content">
                <div id="inboxFolder" class="mail-folder active">
                    <ul id="inboxContent"></ul>
                </div>
                <div id="sentFolder" class="mail-folder">
                    <ul id="sentContent"></ul>
                </div>
                <div id="draftsFolder" class="mail-folder">
                    <ul id="draftsContent"></ul>
                </div>
            </div>
        </div>
    </div>
    <div id="suspendedScreen" class="screen">
        <div class="container suspended-portal">
            <h2>ðŸš« Portal Suspended</h2>
            <div class="suspended-message">
                <p>Your portal is temporarily suspended.</p>
                <p>Please contact <strong>Marcus Ray</strong> for more details.</p>
            </div>
            <div class="suspended-contact">
                <p>ðŸ“§ Contact: <a href="mailto:marcus@cirkledevelopment.co.uk">marcus@cirkledevelopment.co.uk</a></p>
                <p>ðŸ’¬ Discord: Marcus Ray</p>
            </div>
        </div>
    </div>
    <div id="goodbyeScreen" class="screen">
        <div class="container">
            <h2>Goodbye, <span id="goodbyeName"></span></h2>
        </div>
    </div>
    <div id="mailDeliveryAnimation" class="mail-delivery-animation hidden"></div>

    <footer>Â© Cirkle Development 2024</footer>

    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="script.js"></script>
</body>
</html>