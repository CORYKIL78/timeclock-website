<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Portal</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Sidebar (desktop) / Topbar (mobile) -->
    <div id="sidebar" class="sidebar hidden">
        <div class="sidebar-header">
            <img id="sidebarProfilePic" class="profile-img" src="" alt="Profile">
        </div>
        <button class="sidebar-toggle">☰</button>
        <div id="sidebarNav">
            <button id="homeBtn">Home</button>
            <button id="myRolesBtn">My Roles</button>
            <button id="tasksBtn">Tasks</button>
            <button id="absencesBtn">Absences</button>
            <button id="payslipsBtn">Payslips</button>
            <button id="disciplinariesBtn">Disciplinaries</button>
            <button id="timeclockBtn">Timeclock</button>
            <button id="mailBtn">Mail</button>
            <button id="handbooksBtn">Handbooks</button>
        </div>
        <div class="sidebar-footer">
            <img src="https://media.discordapp.net/attachments/1315278404009988107/1315278404412768266/Utilities.png?ex=68e8ed78&is=68e79bf8&hm=27f1b2498c2043117d89a2d04ed0e42d509e442639da1a553ed7dbed9fa4733c&=&format=webp&quality=lossless&width=550&height=550" alt="logo" style="width: 30px; height: auto;">
            <button id="logoutBtn" class="action-btn" title="Log Out">Log Out</button>
        </div>
    </div>

    <!-- Notifications Panel -->
    <div id="notificationPanel" class="notifications hidden">
        <h3>Notifications</h3>
        <ul id="notificationList"></ul>
    </div>

    <!-- Modals -->
    <div id="alertModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="alertMessage"></div>
        </div>
    </div>
    <div id="composeMailModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="mail-compose">
                <h2>Compose Mail</h2>
                <select id="mailRecipients" multiple required>
                    <option value="" disabled>Select Recipients</option>
                </select>
                <input type="text" id="mailSubject" placeholder="Subject">
                <textarea id="mailContent" placeholder="Message"></textarea>
                <input type="file" id="mailAttachments" multiple>
                <div id="mailError" class="mail-error hidden">Select at least one participant</div>
                <div class="mail-actions">
                    <button id="sendMailBtn">Send</button>
                    <button id="saveDraftBtn">Save to Drafts</button>
                </div>
            </div>
        </div>
    </div>
    <div id="resetProfileModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Reset Profile</h2>
            <p>Are you sure you want to reset your profile? This cannot be undone.</p>
            <button id="confirmResetBtn">Confirm</button>
        </div>
    </div>
    <div id="absenceRequestModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Request Absence</h2>
            <select id="absenceType">
                <option value="Illness">Illness</option>
                <option value="Vacation">Vacation</option>
                <option value="Personal">Personal</option>
                <option value="Education">Education</option>
                <option value="No Device/Wifi">No Device/Wifi</option>
                <option value="Other">Other (specify in comment)</option>
            </select>
            <input type="date" id="absenceStartDate">
            <input type="date" id="absenceEndDate">
            <textarea id="absenceComment" placeholder="Comment"></textarea>
            <p id="absenceDays">Total Days: 0</p>
            <button id="submitAbsenceBtn">Submit</button>
        </div>
    </div>
    <div id="deptChangeModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Change Department</h2>
            <p>Which department do you wish to change to?</p>
            <label><input type="radio" name="newDepartment" value="Development Department"> Development</label>
            <label><input type="radio" name="newDepartment" value="Customer Relations Department"> Customer Relations</label>
            <label><input type="radio" name="newDepartment" value="Careers Department"> Careers</label>
            <button id="submitDeptChangeBtn">Submit</button>
        </div>
    </div>
    <div id="viewMailModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="viewMailContent"></div>
            <button id="replyMailBtn" class="hidden">Reply</button>
        </div>
    </div>
    <div id="replyMailModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Reply to Mail</h2>
            <textarea id="replyContent" placeholder="Your reply..."></textarea>
            <button id="sendReplyBtn">Send</button>
        </div>
    </div>
    <div id="absenceDetailModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Absence Details</h2>
            <div id="absenceDetailContent" class="absence-details">
                <p><strong>Type:</strong> <span id="absenceDetailType"></span></p>
                <p><strong>Start Date:</strong> <span id="absenceDetailStartDate"></span></p>
                <p><strong>End Date:</strong> <span id="absenceDetailEndDate"></span></p>
                <p><strong>Total Days:</strong> <span id="absenceDetailDays"></span></p>
                <p><strong>Reason:</strong> <span id="absenceDetailReason"></span></p>
                <p><strong>Comment:</strong> <span id="absenceDetailComment"></span></p>
            </div>
            <button id="cancelAbsenceBtn" class="cancel-absence-btn hidden">Cancel Absence</button>
            <button id="deleteAbsenceBtn" class="delete-absence-btn hidden">Delete Absence</button>
        </div>
    </div>
    <div id="confirmCancelAbsenceModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Confirm Absence Cancellation</h2>
            <p>Are you sure you want to cancel your absence?</p>
            <button id="confirmCancelAbsenceBtn" class="cancel-absence-btn">Cancel Absence</button>
            <button id="noCancelAbsenceBtn">No</button>
        </div>
    </div>
    <div id="payslipViewModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Payslip Details</h2>
            <div id="payslipViewContent">
                <p><strong>Date:</strong> <span id="payslipDate"></span></p>
                <p><strong>Link:</strong> <a id="payslipLink" href="#" target="_blank">View Payslip</a></p>
                <p><strong>Comment:</strong> <span id="payslipComment"></span></p>
                <p><strong>Assigned by:</strong> <span id="payslipAssignedBy"></span></p>
            </div>
        </div>
    </div>

    <div id="assignPayslipModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Assign Payslip</h2>
            <div id="assignPayslipContent">
                <div style="margin: 15px 0;">
                    <label for="assignStaffId"><strong>Staff ID:</strong></label>
                    <input type="text" id="assignStaffId" placeholder="Enter Staff ID" style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;">
                </div>
                <div style="margin: 15px 0;">
                    <label for="assignPayslipLink"><strong>Link:</strong></label>
                    <input type="url" id="assignPayslipLink" placeholder="Enter payslip link" style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;">
                </div>
                <div style="margin: 15px 0;">
                    <label for="assignPayslipComment"><strong>Comment:</strong></label>
                    <textarea id="assignPayslipComment" placeholder="Add a comment (optional)" style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px; height: 80px; resize: vertical;"></textarea>
                </div>
                <div style="margin: 15px 0;">
                    <label for="assignedByName"><strong>Your Name:</strong></label>
                    <input type="text" id="assignedByName" placeholder="e.g. Marcus Ray" style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;">
                </div>
                <div style="margin: 15px 0;">
                    <label for="submitAction"><strong>Action:</strong></label>
                    <select id="submitAction" style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="">Select Action</option>
                        <option value="Submit">Submit</option>
                    </select>
                </div>
                <div style="margin: 20px 0; text-align: center;">
                    <button id="assignPayslipBtn" style="padding: 10px 20px; background: #1976d2; color: white; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px;">Assign Payslip</button>
                    <button id="cancelAssignPayslipBtn" style="padding: 10px 20px; background: #666; color: white; border: none; border-radius: 5px; cursor: pointer;">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Screens -->
    <div id="discordScreen" class="screen">
        <div class="container">
            <img class="logo" src="https://media.discordapp.net/attachments/1315278404009988107/1322985671773655200/Cirkledevblack.png?ex=68e89f2c&is=68e74dac&hm=b8bc37a71a49e8136a1a05fd89154cd1a2ac00ffe3af6112d42e49610cc76582&=&format=webp&quality=lossless&width=1056&height=594" alt="Logo">
            <h1>Welcome, please log in using Discord</h1>
            <button id="discordLoginBtn">Login with Discord</button>
        </div>
    </div>
    <div id="searchingScreen" class="screen loading-screen">
        <div class="container black-bg">
            <h2>Searching...</h2>
            <div class="spinner"></div>
        </div>
    </div>
    <div id="rolesScreen" class="screen loading-screen">
        <div class="container black-bg">
            <h2>Checking Roles...</h2>
            <div class="spinner"></div>
        </div>
    </div>
    <div id="cherryScreen" class="screen loading-screen">
        <div class="container black-bg">
            <h2>Verifying...</h2>
            <div class="spinner"></div>
        </div>
    </div>
    <div id="confirmScreen" class="screen">
        <div class="container">
            <h2>Profile Found</h2>
            <p>Please select "Finalise" to continue.</p>
            <button id="continueBtn">Finalise</button>
        </div>
    </div>
    <div id="setupWelcomeScreen" class="screen">
        <div class="container">
            <h2>Welcome!</h2>
            <p>Please set up your profile to continue.</p>
            <button id="setupStartBtn">Start</button>
        </div>
    </div>
    <div id="setupEmailScreen" class="screen">
        <div class="container">
            <h2>Please add your email</h2>
            <input type="email" id="setupEmailInput" placeholder="Email">
            <button id="setupEmailContinueBtn">Continue</button>
        </div>
    </div>
    <div id="setupNameScreen" class="screen">
        <div class="container">
            <h2>Let's give you a proper identity</h2>
            <p>Please insert your first and last name (not your real one, the one you use in the server)</p>
            <input type="text" id="setupNameInput" placeholder="First Last">
            <button id="setupNameContinueBtn">Continue</button>
        </div>
    </div>
    <div id="setupDepartmentScreen" class="screen">
        <div class="container">
            <h2>Finally, let's select your department</h2>
            <label><input type="radio" name="department" value="Development Department"> Development</label>
            <label><input type="radio" name="department" value="Customer Relations Department"> Customer Relations</label>
            <label><input type="radio" name="department" value="Careers Department"> Careers</label>
            <button id="setupDepartmentContinueBtn">Continue</button>
        </div>
    </div>
    <div id="setupVerifyScreen" class="screen loading-screen">
        <div class="container black-bg">
            <h2>Verifying...</h2>
            <div class="spinner"></div>
            <p class="loading-text">Just setting up your profile</p>
            <p class="loading-text">Creating your unique interface</p>
            <p class="loading-text">Finalising</p>
        </div>
    </div>
    <div id="setupCompleteScreen" class="screen">
        <div class="container">
            <h2>Welcome, <span id="setupWelcomeName"></span>, to your new Staff Portal!</h2>
            <p>Let's take a look around!</p>
            <button id="setupCompleteBtn">Continue</button>
        </div>
    </div>
    <div id="portalWelcomeScreen" class="screen">
        <div class="container">
            <img id="portalWelcomeProfilePic" class="profile-img" src="" alt="Profile" style="display:block;margin:0 auto 1em auto;width:100px;height:100px;border-radius:50%;object-fit:cover;">
            <h2>Welcome back, <span id="portalWelcomeName"></span>!</h2>
            <p>Previous login: <span id="portalLastLogin"></span></p>
            <button id="portalLoginBtn">Log In</button>
        </div>
    </div>
    <div id="mainMenuScreen" class="screen">
        <div class="container">
            <div class="user-header">
                <img id="mainProfilePic" class="profile-img" src="" alt="Profile">
                <div>
                    <h2 id="greeting"></h2>
                    <p id="lastLogin"></p>
                </div>
                <p id="dateTime" style="margin-left: auto;"></p>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Absences</h3>
                    <p id="totalAbsences">0</p>
                    <h3>Total Absence Days</h3>
                    <p id="totalAbsenceDays">0</p>
                </div>
                <div class="stat-card">
                    <h3>Department</h3>
                    <p id="currentDepartment">Development</p>
                    <p class="hint">Wish to change? Click the button below to go to your profile settings and request a change.</p>
                    <button id="changeDepartmentBtn">Change My Department</button>
                </div>
            </div>
        </div>
    </div>
    <div id="myProfileScreen" class="screen">
        <div class="container profile-config-container">
            <div class="profile-main-row">
                <div class="profile-pic-col">
                    <img id="profilePic" class="profile-img-large" src="" alt="Profile Picture">
                </div>
                <div class="profile-info-col">
                    <div class="profile-row">
                        <span class="profile-label">Name:</span>
                        <span id="profileName"></span>
                        <button class="edit-btn" id="editNameBtn" title="Edit Name">✎</button>
                    </div>
                    <div class="profile-row">
                        <span class="profile-label">Email:</span>
                        <span id="profileEmail"></span>
                        <button class="edit-btn" id="editEmailBtn" title="Edit Email">✎</button>
                    </div>
                    <div class="profile-row">
                        <span class="profile-label">Department:</span>
                        <span id="profileDepartment"></span>
                        <button class="edit-btn" id="editDeptBtn" title="Edit Department">✎</button>
                    </div>
                    <div id="editFieldsContainer" class="edit-fields-container"></div>
                    <div id="profileDebug" style="margin-top:16px;color:#b71c1c;font-size:0.95em;"></div>
                    <div id="authDebug" style="margin-top:8px;color:#1976d2;font-size:0.95em;"></div>
                    <div class="profile-actions-row">
                        <div class="profile-actions-left">
                            <label class="switch darkmode-switch">
                                <input type="checkbox" id="modeToggle">
                                <span class="slider"></span>
                            </label>
                            <span class="darkmode-label">Dark Mode</span>
                        </div>
                        <div class="profile-actions-right">
                            <button id="resetProfileBtn" class="big-red-btn">Reset Profile</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="myRolesScreen" class="screen">
        <div class="container">
            <h2>My Roles</h2>
            <ul id="rolesList"></ul>
        </div>
    </div>
    <div id="tasksScreen" class="screen">
        <div class="container">
            <h2>Tasks</h2>
            <div class="task-input">
                <input type="text" id="taskInput" placeholder="Add a task">
                <button id="addTaskBtn">&#8594;</button>
            </div>
            <ul id="tasksList"></ul>
        </div>
    </div>
    <div id="absencesScreen" class="screen">
        <div class="container">
            <h2>Absences</h2>
            <button id="requestAbsenceBtn">Request Absence</button>
            <div class="absence-tabs">
                <button class="absence-tab-btn active" data-tab="pending">Pending</button>
                <button class="absence-tab-btn" data-tab="approved">Approved</button>
                <button class="absence-tab-btn" data-tab="rejected">Rejected</button>
                <button class="absence-tab-btn" data-tab="archived">Archived</button>
                <div class="absence-tab-slider"></div>
            </div>
            <div class="absence-content">
                <div id="pendingFolder" class="absence-folder active">
                    <ul id="pendingAbsences"></ul>
                </div>
                <div id="approvedFolder" class="absence-folder">
                    <ul id="approvedAbsences"></ul>
                </div>
                <div id="rejectedFolder" class="absence-folder">
                    <ul id="rejectedAbsences"></ul>
                </div>
                <div id="archivedFolder" class="absence-folder">
                    <ul id="archivedAbsences"></ul>
                </div>
            </div>
        </div>
    </div>
    <div id="payslipsScreen" class="screen">
        <div class="container">
            <h2>Payslips</h2>
            <div id="payslipsContent"></div>
        </div>
    </div>
    <div id="disciplinariesScreen" class="screen">
        <div class="container">
            <h2>Disciplinaries</h2>
            <div id="disciplinariesContent"></div>
        </div>
    </div>
    <div id="timeclockScreen" class="screen">
        <div class="container">
            <h2>Timeclock</h2>
            <div id="clockDisplay"></div>
            <button id="clockInBtn">Clock In</button>
            <button id="clockOutBtn" class="hidden">Clock Out</button>
            <div id="sessionInfo" class="session-item hidden"></div>
            <h3>Previous Sessions</h3>
            <div id="previousSessions" class="session-list"></div>
        </div>
    </div>
    <div id="mailScreen" class="screen">
        <div class="container">
            <h2>Mail</h2>
            <button id="composeMailBtn" title="Compose Mail"></button>
            <div class="mail-tabs">
                <button class="tab-btn active" data-tab="inbox">Inbox</button>
                <button class="tab-btn" data-tab="sent">Sent</button>
                <button class="tab-btn" data-tab="drafts">Drafts</button>
                <div class="tab-slider"></div>
            </div>
            <div class="mail-content">
                <div id="inboxFolder" class="mail-folder active">
                    <ul id="inboxContent"></ul>
                </div>
                <div id="sentFolder" class="mail-folder">
                    <ul id="sentContent"></ul>
                </div>
                <div id="draftsFolder" class="mail-folder">
                    <ul id="draftsContent"></ul>
                </div>
            </div>
        </div>
    </div>
    <div id="goodbyeScreen" class="screen">
        <div class="container">
            <h2>Goodbye, <span id="goodbyeName"></span></h2>
        </div>
    </div>
    <div id="mailDeliveryAnimation" class="mail-delivery-animation hidden"></div>

    <footer>© Cirkle Development 2024</footer>

    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="script.js"></script>
</body>
</html>